<?php
if (!defined('ABSPATH'))
    exit; // Exit if accessed directly

class Post_Info_Widget extends \Elementor\Widget_Base
{

    public function get_name()
    {
        return 'Post_Info_WWidget';
    }

    public function get_title()
    {
        return __('Post Info', 'child_theme');
    }

    public function get_icon()
    {
        return 'eicon-code-bold'; // https://elementor.github.io/elementor-icons/
    }

    public function get_categories()
    {
        return ['custom_builder_theme'];
    }

    protected function _register_controls()
    {
        $this->start_controls_section(
            'content_section',
            [
                'label' => __('Content', 'child_theme'),
                'tab' => \Elementor\Controls_Manager::TAB_CONTENT,
            ]
        );

        $this->end_controls_section();
    }

    protected function render()
    {
        $settings = $this->get_settings_for_display();
        $share_link = get_permalink();
        // count view
        $post_id = get_the_ID();
        set_post_views($post_id);
        $post_views = get_field('post_views_count', $post_id);
        ?>
        <div class="post-info">
            <div class="row post-info__inner">
                <div class="col-5">
                    <div class="author-info">
                        <div class="author-avatar">

                        </div>
                        <a href="<?php echo esc_url(get_author_posts_url(get_the_author_meta('ID'))); ?>" class="author-name">
                            <?php echo get_the_author_meta('nickname'); ?>
                        </a>
                    </div>
                </div>
                <div class="col-7">
                    <div class="post-meta">
                        <div class="meta-item">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <g clip-path="url(#clip0_263_2373)">
                                    <path
                                        d="M5.673 0C5.85865 0 6.0367 0.0737498 6.16797 0.205025C6.29925 0.336301 6.373 0.514348 6.373 0.7V2.009H13.89V0.709C13.89 0.523348 13.9637 0.345301 14.095 0.214025C14.2263 0.0827498 14.4043 0.009 14.59 0.009C14.7757 0.009 14.9537 0.0827498 15.085 0.214025C15.2162 0.345301 15.29 0.523348 15.29 0.709V2.009H18C18.5303 2.009 19.0388 2.21958 19.4139 2.59443C19.7889 2.96929 19.9997 3.47774 20 4.008V18.001C19.9997 18.5313 19.7889 19.0397 19.4139 19.4146C19.0388 19.7894 18.5303 20 18 20H2C1.46974 20 0.961184 19.7894 0.58614 19.4146C0.211096 19.0397 0.00026513 18.5313 0 18.001L0 4.008C0.00026513 3.47774 0.211096 2.96929 0.58614 2.59443C0.961184 2.21958 1.46974 2.009 2 2.009H4.973V0.699C4.97327 0.513522 5.04713 0.335731 5.17838 0.204672C5.30963 0.0736123 5.48752 -1.89263e-07 5.673 0ZM1.4 7.742V18.001C1.4 18.0798 1.41552 18.1578 1.44567 18.2306C1.47583 18.3034 1.52002 18.3695 1.57574 18.4253C1.63145 18.481 1.69759 18.5252 1.77039 18.5553C1.84319 18.5855 1.92121 18.601 2 18.601H18C18.0788 18.601 18.1568 18.5855 18.2296 18.5553C18.3024 18.5252 18.3685 18.481 18.4243 18.4253C18.48 18.3695 18.5242 18.3034 18.5543 18.2306C18.5845 18.1578 18.6 18.0798 18.6 18.001V7.756L1.4 7.742ZM6.667 14.619V16.285H5V14.619H6.667ZM10.833 14.619V16.285H9.167V14.619H10.833ZM15 14.619V16.285H13.333V14.619H15ZM6.667 10.642V12.308H5V10.642H6.667ZM10.833 10.642V12.308H9.167V10.642H10.833ZM15 10.642V12.308H13.333V10.642H15ZM4.973 3.408H2C1.92121 3.408 1.84319 3.42352 1.77039 3.45367C1.69759 3.48382 1.63145 3.52802 1.57574 3.58374C1.52002 3.63945 1.47583 3.70559 1.44567 3.77839C1.41552 3.85119 1.4 3.92921 1.4 4.008V6.343L18.6 6.357V4.008C18.6 3.92921 18.5845 3.85119 18.5543 3.77839C18.5242 3.70559 18.48 3.63945 18.4243 3.58374C18.3685 3.52802 18.3024 3.48382 18.2296 3.45367C18.1568 3.42352 18.0788 3.408 18 3.408H15.29V4.337C15.29 4.52265 15.2162 4.7007 15.085 4.83197C14.9537 4.96325 14.7757 5.037 14.59 5.037C14.4043 5.037 14.2263 4.96325 14.095 4.83197C13.9637 4.7007 13.89 4.52265 13.89 4.337V3.408H6.373V4.328C6.373 4.51365 6.29925 4.6917 6.16797 4.82297C6.0367 4.95425 5.85865 5.028 5.673 5.028C5.48735 5.028 5.3093 4.95425 5.17803 4.82297C5.04675 4.6917 4.973 4.51365 4.973 4.328V3.408Z"
                                        fill="black" />
                                </g>
                                <defs>
                                    <clipPath id="clip0_263_2373">
                                        <rect width="20" height="20" fill="white" />
                                    </clipPath>
                                </defs>
                            </svg>
                            <span>
                                <?php echo get_the_date("d/m/Y"); ?>
                            </span>
                        </div>
                        <div class="meta-item">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M15 12C15 12.7956 14.6839 13.5587 14.1213 14.1213C13.5587 14.6839 12.7956 15 12 15C11.2044 15 10.4413 14.6839 9.87868 14.1213C9.31607 13.5587 9 12.7956 9 12C9 11.2044 9.31607 10.4413 9.87868 9.87868C10.4413 9.31607 11.2044 9 12 9C12.7956 9 13.5587 9.31607 14.1213 9.87868C14.6839 10.4413 15 11.2044 15 12Z"
                                    stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                                <path
                                    d="M2 12C3.6 7.903 7.336 5 12 5C16.664 5 20.4 7.903 22 12C20.4 16.097 16.664 19 12 19C7.336 19 3.6 16.097 2 12Z"
                                    stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            <span> <?php echo $post_views ?? 0; ?></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row post-info__inner">
                <div class="col-5">
                    <div class="social-links">
                        <a href="https://www.facebook.com/sharer/sharer.php?u=<?php echo $share_link; ?>"
                            onclick="window.open(this.href, this.target, 'width=500,height=500'); return false;"
                            class="social-link">
                            <svg width="11" height="18" viewBox="0 0 11 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M3.13896 17.6404H6.7769V10.3556H10.0547L10.4148 6.73555H6.7769V4.90772C6.7769 4.40544 7.18407 3.99825 7.68637 3.99825H10.4148V0.360352H7.68637C5.17486 0.360352 3.13896 2.39628 3.13896 4.90772V6.73555H1.32001L0.959961 10.3556H3.13896V17.6404Z"
                                    fill="#D42328" />
                            </svg>
                        </a>
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=<?php echo $share_link; ?>&title=text"
                            onclick="window.open(this.href, this.target, 'width=500,height=500'); return false;"
                            class="social-link">
                            <svg width="19" height="19" viewBox="0 0 19 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                    d="M7.46479 7.10013H10.405V8.56472C10.8286 7.72238 11.9147 6.96555 13.5464 6.96555C16.6742 6.96555 17.4168 8.6423 17.4168 11.7187V17.4163H14.2502V12.4193C14.2502 10.6674 13.8266 9.67938 12.7484 9.67938C11.2529 9.67938 10.6315 10.7442 10.6315 12.4186V17.4163H7.46479V7.10013ZM2.03475 17.2818H5.20141V6.96555H2.03475V17.2818ZM5.65504 3.60176C5.65516 3.86718 5.60252 4.12999 5.50018 4.37489C5.39784 4.61979 5.24785 4.84191 5.05891 5.02834C4.86942 5.21685 4.64464 5.36618 4.39741 5.46778C4.15019 5.56939 3.88537 5.62129 3.61808 5.62051C3.07943 5.6193 2.56272 5.40699 2.17883 5.02913C1.99065 4.84202 1.84121 4.61964 1.73906 4.37472C1.6369 4.12979 1.58404 3.86713 1.5835 3.60176C1.5835 3.0658 1.79725 2.5528 2.17962 2.17438C2.56255 1.79508 3.07989 1.58251 3.61887 1.58301C4.15879 1.58301 4.67654 1.79597 5.05891 2.17438C5.44129 2.5528 5.65504 3.0658 5.65504 3.60176Z"
                                    fill="#D42328" />
                            </svg>
                        </a>
                        <a href="https://www.youtube.com/share?url=<?php echo urlencode($share_link); ?>"
                            onclick="window.open(this.href, this.target, 'width=500,height=500'); return false;"
                            class="social-link">
                            <svg width="21" height="16" viewBox="0 0 21 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M20.4561 7.93775C20.4561 7.889 20.4561 7.8336 20.4538 7.76933C20.4516 7.58983 20.4472 7.38817 20.4428 7.17321C20.425 6.55493 20.394 5.93886 20.3452 5.35825C20.2788 4.55825 20.1813 3.89122 20.0483 3.39039C19.908 2.86773 19.6329 2.39105 19.2507 2.008C18.8684 1.62494 18.3923 1.34894 17.8699 1.20756C17.2428 1.03914 16.0151 0.934985 14.2865 0.870719C13.4644 0.839694 12.5846 0.819749 11.7048 0.808669C11.3968 0.804237 11.1109 0.802021 10.8538 0.799805H10.2023C9.94525 0.802021 9.65938 0.804237 9.35134 0.808669C8.47157 0.819749 7.59179 0.839694 6.76963 0.870719C5.04109 0.937201 3.81118 1.04136 3.18625 1.20756C2.6637 1.34859 2.1874 1.62448 1.80507 2.00759C1.42274 2.39069 1.14782 2.86755 1.00785 3.39039C0.872674 3.89122 0.777383 4.55825 0.710901 5.35825C0.662148 5.93886 0.631123 6.55493 0.613394 7.17321C0.606746 7.38817 0.60453 7.58983 0.602314 7.76933C0.602314 7.8336 0.600098 7.889 0.600098 7.93775V8.06185C0.600098 8.11061 0.600098 8.16601 0.602314 8.23028C0.60453 8.40978 0.608962 8.61144 0.613394 8.8264C0.631123 9.44468 0.662148 10.0607 0.710901 10.6414C0.777383 11.4414 0.87489 12.1084 1.00785 12.6092C1.29151 13.6707 2.12475 14.5084 3.18625 14.792C3.81118 14.9605 5.04109 15.0646 6.76963 15.1289C7.59179 15.1599 8.47157 15.1799 9.35134 15.1909C9.65938 15.1954 9.94525 15.1976 10.2023 15.1998H10.8538C11.1109 15.1976 11.3968 15.1954 11.7048 15.1909C12.5846 15.1799 13.4644 15.1599 14.2865 15.1289C16.0151 15.0624 17.245 14.9583 17.8699 14.792C18.9314 14.5084 19.7646 13.6729 20.0483 12.6092C20.1835 12.1084 20.2788 11.4414 20.3452 10.6414C20.394 10.0607 20.425 9.44468 20.4428 8.8264C20.4494 8.61144 20.4516 8.40978 20.4538 8.23028C20.4538 8.16601 20.4561 8.11061 20.4561 8.06185V7.93775ZM18.8605 8.05299C18.8605 8.09953 18.8605 8.1505 18.8583 8.21033C18.8561 8.38318 18.8516 8.57377 18.8472 8.77986C18.8317 9.36933 18.8007 9.95881 18.7541 10.5062C18.6943 11.2197 18.6101 11.8048 18.5059 12.197C18.3685 12.7089 17.9652 13.1145 17.4555 13.2497C16.9901 13.3738 15.8178 13.4735 14.2245 13.5333C13.4178 13.5643 12.5491 13.5843 11.6826 13.5954C11.379 13.5998 11.0976 13.602 10.845 13.602H10.2112L9.3735 13.5954C8.50702 13.5843 7.64054 13.5643 6.83168 13.5333C5.23833 13.4713 4.06381 13.3738 3.60065 13.2497C3.09096 13.1123 2.68763 12.7089 2.55024 12.197C2.44608 11.8048 2.36187 11.2197 2.30204 10.5062C2.2555 9.95881 2.22669 9.36933 2.20896 8.77986C2.20231 8.57377 2.2001 8.38097 2.19788 8.21033C2.19788 8.1505 2.19567 8.09731 2.19567 8.05299V7.94662C2.19567 7.90008 2.19567 7.84911 2.19788 7.78928C2.2001 7.61643 2.20453 7.42584 2.20896 7.21975C2.22447 6.63028 2.2555 6.0408 2.30204 5.49343C2.36187 4.77986 2.44608 4.19482 2.55024 3.80257C2.68763 3.29066 3.09096 2.88512 3.60065 2.74994C4.06603 2.62584 5.23833 2.52612 6.83168 2.46629C7.63832 2.43526 8.50702 2.41532 9.3735 2.40424C9.67711 2.3998 9.95855 2.39759 10.2112 2.39759H10.845L11.6826 2.40424C12.5491 2.41532 13.4156 2.43526 14.2245 2.46629C15.8178 2.52834 16.9923 2.62584 17.4555 2.74994C17.9652 2.88734 18.3685 3.29066 18.5059 3.80257C18.6101 4.19482 18.6943 4.77986 18.7541 5.49343C18.8007 6.0408 18.8295 6.63028 18.8472 7.21975C18.8538 7.42584 18.8561 7.61864 18.8583 7.78928C18.8583 7.84911 18.8605 7.9023 18.8605 7.94662V8.05299ZM8.55578 10.9693L13.6971 7.97764L8.55578 5.03028V10.9693Z"
                                    fill="#D42328" />
                            </svg>
                        </a>
                    </div>
                </div>
                <div class="col-7">
                    <div class="post-rating">
                        <span class="rating-text"><strong>Đánh giá:</strong> 5/5 (<?php echo get_comments_number(); ?> Bình
                            chọn)</span>
                        <div class="rating-stars">
                            <?php for ($i = 0; $i < 5; $i++): ?>
                                <svg width="19" height="18" viewBox="0 0 19 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M8.6449 2.15099C8.73202 2.00936 8.85681 1.89185 9.00684 1.81017C9.15686 1.7285 9.32687 1.68552 9.4999 1.68552C9.67293 1.68552 9.84293 1.7285 9.99296 1.81017C10.143 1.89185 10.2678 2.00936 10.3549 2.15099L12.5676 5.74949L16.8648 6.63149C17.0338 6.66629 17.1903 6.74245 17.3185 6.85239C17.4468 6.96233 17.5424 7.1022 17.5958 7.25806C17.6493 7.41392 17.6586 7.58032 17.623 7.74068C17.5874 7.90104 17.508 8.04975 17.3928 8.17199L14.4636 11.2777L14.907 15.4215C14.9245 15.5847 14.8965 15.7493 14.8258 15.899C14.7551 16.0487 14.6442 16.1783 14.5041 16.2747C14.3641 16.3711 14.1998 16.431 14.0276 16.4484C13.8555 16.4658 13.6815 16.4402 13.5231 16.374L9.4999 14.694L5.47665 16.374C5.31825 16.4402 5.1443 16.4658 4.97216 16.4484C4.80002 16.431 4.63573 16.3711 4.49567 16.2747C4.35562 16.1783 4.2447 16.0487 4.17401 15.899C4.10332 15.7493 4.07532 15.5847 4.09281 15.4215L4.53615 11.2777L1.60698 8.17274C1.49158 8.05051 1.41204 7.90174 1.3763 7.74128C1.34056 7.58082 1.34988 7.41429 1.40332 7.25831C1.45676 7.10233 1.55245 6.96236 1.68085 6.85237C1.80924 6.74238 1.96584 6.66622 2.13502 6.63149L6.43219 5.74949L8.6449 2.15099Z"
                                        fill="#FFD448" />
                                </svg>
                            <?php endfor; ?>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <?php
    }
}
