<?php
if (!defined('ABSPATH'))
    exit; // Exit if accessed directly

class Post_Info_Widget extends \Elementor\Widget_Base
{

    public function get_name()
    {
        return 'Post_Info_WWidget';
    }

    public function get_title()
    {
        return __('Post Info', 'child_theme');
    }

    public function get_icon()
    {
        return 'eicon-code-bold'; // https://elementor.github.io/elementor-icons/
    }

    public function get_categories()
    {
        return ['custom_builder_theme'];
    }

    protected function _register_controls()
    {
        $this->start_controls_section(
            'content_section',
            [
                'label' => __('Content', 'child_theme'),
                'tab' => \Elementor\Controls_Manager::TAB_CONTENT,
            ]
        );

        $this->end_controls_section();
    }

    protected function render()
    {
        $settings = $this->get_settings_for_display();
        $share_link = get_permalink();
        // count view
        $post_id = get_the_ID();
        set_post_views($post_id);
        $post_views = get_field('post_views_count', $post_id);
?>
        <div class="post-info">
            <div class="row post-info__inner">
                <div class="col-md-12 col-lg-5">
                    <div class="author-info">
                        <div class="author-avatar single_post_author_avatar">
                            <?php
                            $user_id = get_the_author_meta('ID');
                            $avatar = get_user_meta($user_id, 'avatar', true);
                            if ($avatar) {
                                echo '<img alt="" src="' . wp_get_attachment_url($avatar) . '" class="avatar avatar-96 photo" height="96" width="96" decoding="async">';
                            }
                            ?>
                        </div>
                        <?php
                        $link_page_author = get_user_meta($user_id, 'link_page_author', true);
                        ?>
                        <a href="<?php echo $link_page_author ?: 'javascript:void(0);'; ?>" class="author-name">
                            <?php echo get_the_author_meta('nickname'); ?>
                        </a>
                    </div>
                </div>
                <div class="col-md-12 col-lg-7">
                    <div class="post-meta">
                        <div class="meta-item">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <g clip-path="url(#clip0_263_2373)">
                                    <path
                                        d="M5.673 0C5.85865 0 6.0367 0.0737498 6.16797 0.205025C6.29925 0.336301 6.373 0.514348 6.373 0.7V2.009H13.89V0.709C13.89 0.523348 13.9637 0.345301 14.095 0.214025C14.2263 0.0827498 14.4043 0.009 14.59 0.009C14.7757 0.009 14.9537 0.0827498 15.085 0.214025C15.2162 0.345301 15.29 0.523348 15.29 0.709V2.009H18C18.5303 2.009 19.0388 2.21958 19.4139 2.59443C19.7889 2.96929 19.9997 3.47774 20 4.008V18.001C19.9997 18.5313 19.7889 19.0397 19.4139 19.4146C19.0388 19.7894 18.5303 20 18 20H2C1.46974 20 0.961184 19.7894 0.58614 19.4146C0.211096 19.0397 0.00026513 18.5313 0 18.001L0 4.008C0.00026513 3.47774 0.211096 2.96929 0.58614 2.59443C0.961184 2.21958 1.46974 2.009 2 2.009H4.973V0.699C4.97327 0.513522 5.04713 0.335731 5.17838 0.204672C5.30963 0.0736123 5.48752 -1.89263e-07 5.673 0ZM1.4 7.742V18.001C1.4 18.0798 1.41552 18.1578 1.44567 18.2306C1.47583 18.3034 1.52002 18.3695 1.57574 18.4253C1.63145 18.481 1.69759 18.5252 1.77039 18.5553C1.84319 18.5855 1.92121 18.601 2 18.601H18C18.0788 18.601 18.1568 18.5855 18.2296 18.5553C18.3024 18.5252 18.3685 18.481 18.4243 18.4253C18.48 18.3695 18.5242 18.3034 18.5543 18.2306C18.5845 18.1578 18.6 18.0798 18.6 18.001V7.756L1.4 7.742ZM6.667 14.619V16.285H5V14.619H6.667ZM10.833 14.619V16.285H9.167V14.619H10.833ZM15 14.619V16.285H13.333V14.619H15ZM6.667 10.642V12.308H5V10.642H6.667ZM10.833 10.642V12.308H9.167V10.642H10.833ZM15 10.642V12.308H13.333V10.642H15ZM4.973 3.408H2C1.92121 3.408 1.84319 3.42352 1.77039 3.45367C1.69759 3.48382 1.63145 3.52802 1.57574 3.58374C1.52002 3.63945 1.47583 3.70559 1.44567 3.77839C1.41552 3.85119 1.4 3.92921 1.4 4.008V6.343L18.6 6.357V4.008C18.6 3.92921 18.5845 3.85119 18.5543 3.77839C18.5242 3.70559 18.48 3.63945 18.4243 3.58374C18.3685 3.52802 18.3024 3.48382 18.2296 3.45367C18.1568 3.42352 18.0788 3.408 18 3.408H15.29V4.337C15.29 4.52265 15.2162 4.7007 15.085 4.83197C14.9537 4.96325 14.7757 5.037 14.59 5.037C14.4043 5.037 14.2263 4.96325 14.095 4.83197C13.9637 4.7007 13.89 4.52265 13.89 4.337V3.408H6.373V4.328C6.373 4.51365 6.29925 4.6917 6.16797 4.82297C6.0367 4.95425 5.85865 5.028 5.673 5.028C5.48735 5.028 5.3093 4.95425 5.17803 4.82297C5.04675 4.6917 4.973 4.51365 4.973 4.328V3.408Z"
                                        fill="black" />
                                </g>
                                <defs>
                                    <clipPath id="clip0_263_2373">
                                        <rect width="20" height="20" fill="white" />
                                    </clipPath>
                                </defs>
                            </svg>
                            <span>
                                <?php echo get_the_date("d/m/Y"); ?>
                            </span>
                        </div>
                        <div class="meta-item">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M15 12C15 12.7956 14.6839 13.5587 14.1213 14.1213C13.5587 14.6839 12.7956 15 12 15C11.2044 15 10.4413 14.6839 9.87868 14.1213C9.31607 13.5587 9 12.7956 9 12C9 11.2044 9.31607 10.4413 9.87868 9.87868C10.4413 9.31607 11.2044 9 12 9C12.7956 9 13.5587 9.31607 14.1213 9.87868C14.6839 10.4413 15 11.2044 15 12Z"
                                    stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                                <path
                                    d="M2 12C3.6 7.903 7.336 5 12 5C16.664 5 20.4 7.903 22 12C20.4 16.097 16.664 19 12 19C7.336 19 3.6 16.097 2 12Z"
                                    stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            <span> <?php echo $post_views ?? 0; ?></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row post-info__inner">
                <div class="col-md-4 col-lg-4">
                    <div class="social-links">
                        <a href="https://www.facebook.com/sharer/sharer.php?u=<?php echo $share_link; ?>"
                            onclick="window.open(this.href, this.target, 'width=500,height=500'); return false;"
                            class="social-link">
                            <svg width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect x="0.5" y="0.5" width="35" height="35" rx="15.5" stroke="#D42328" />
                                <path
                                    d="M15.139 26.6404H18.7769V19.3556H22.0547L22.4148 15.7356H18.7769V13.9077C18.7769 13.4054 19.1841 12.9982 19.6864 12.9982H22.4148V9.36035H19.6864C17.1749 9.36035 15.139 11.3963 15.139 13.9077V15.7356H13.32L12.96 19.3556H15.139V26.6404Z"
                                    fill="#D42328" />
                            </svg>
                        </a>
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=<?php echo $share_link; ?>&title=text"
                            onclick="window.open(this.href, this.target, 'width=500,height=500'); return false;"
                            class="social-link">
                            <svg width="37" height="36" viewBox="0 0 37 36" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect x="0.700195" y="0.5" width="35" height="35" rx="15.5" stroke="#D42328" />
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                    d="M15.4648 15.1001H18.405V16.5647C18.8286 15.7224 19.9147 14.9656 21.5464 14.9656C24.6742 14.9656 25.4168 16.6423 25.4168 19.7187V25.4163H22.2502V20.4193C22.2502 18.6674 21.8266 17.6794 20.7484 17.6794C19.2529 17.6794 18.6315 18.7442 18.6315 20.4186V25.4163H15.4648V15.1001ZM10.0347 25.2818H13.2014V14.9656H10.0347V25.2818ZM13.655 11.6018C13.6552 11.8672 13.6025 12.13 13.5002 12.3749C13.3978 12.6198 13.2478 12.8419 13.0589 13.0283C12.8694 13.2169 12.6446 13.3662 12.3974 13.4678C12.1502 13.5694 11.8854 13.6213 11.6181 13.6205C11.0794 13.6193 10.5627 13.407 10.1788 13.0291C9.99065 12.842 9.84121 12.6196 9.73906 12.3747C9.6369 12.1298 9.58404 11.8671 9.5835 11.6018C9.5835 11.0658 9.79725 10.5528 10.1796 10.1744C10.5626 9.79508 11.0799 9.58251 11.6189 9.58301C12.1588 9.58301 12.6765 9.79597 13.0589 10.1744C13.4413 10.5528 13.655 11.0658 13.655 11.6018Z"
                                    fill="#D42328" />
                            </svg>
                        </a>
                        <a href="https://www.youtube.com/share?url=<?php echo urlencode($share_link); ?>"
                            onclick="window.open(this.href, this.target, 'width=500,height=500'); return false;"
                            class="social-link">
                            <svg width="37" height="36" viewBox="0 0 37 36" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect x="1.18018" y="0.5" width="35" height="35" rx="15.5" stroke="#D42328" />
                                <path
                                    d="M28.4561 17.9379C28.4561 17.8891 28.4561 17.8337 28.4538 17.7695C28.4516 17.59 28.4472 17.3883 28.4428 17.1733C28.425 16.5551 28.394 15.939 28.3452 15.3584C28.2788 14.5584 28.1813 13.8913 28.0483 13.3905C27.908 12.8678 27.6329 12.3912 27.2507 12.0081C26.8684 11.6251 26.3923 11.3491 25.8699 11.2077C25.2428 11.0393 24.0151 10.9351 22.2865 10.8708C21.4644 10.8398 20.5846 10.8199 19.7048 10.8088C19.3968 10.8044 19.1109 10.8021 18.8538 10.7999H18.2023C17.9452 10.8021 17.6594 10.8044 17.3513 10.8088C16.4716 10.8199 15.5918 10.8398 14.7696 10.8708C13.0411 10.9373 11.8112 11.0415 11.1862 11.2077C10.6637 11.3487 10.1874 11.6246 9.80507 12.0077C9.42274 12.3908 9.14782 12.8677 9.00785 13.3905C8.87267 13.8913 8.77738 14.5584 8.7109 15.3584C8.66215 15.939 8.63112 16.5551 8.61339 17.1733C8.60675 17.3883 8.60453 17.59 8.60231 17.7695C8.60231 17.8337 8.6001 17.8891 8.6001 17.9379V18.062C8.6001 18.1107 8.6001 18.1661 8.60231 18.2304C8.60453 18.4099 8.60896 18.6116 8.61339 18.8265C8.63112 19.4448 8.66215 20.0609 8.7109 20.6415C8.77738 21.4415 8.87489 22.1085 9.00785 22.6093C9.29151 23.6708 10.1248 24.5085 11.1862 24.7922C11.8112 24.9606 13.0411 25.0647 14.7696 25.129C15.5918 25.16 16.4716 25.18 17.3513 25.1911C17.6594 25.1955 17.9452 25.1977 18.2023 25.1999H18.8538C19.1109 25.1977 19.3968 25.1955 19.7048 25.1911C20.5846 25.18 21.4644 25.16 22.2865 25.129C24.0151 25.0625 25.245 24.9584 25.8699 24.7922C26.9314 24.5085 27.7646 23.6731 28.0483 22.6093C28.1835 22.1085 28.2788 21.4415 28.3452 20.6415C28.394 20.0609 28.425 19.4448 28.4428 18.8265C28.4494 18.6116 28.4516 18.4099 28.4538 18.2304C28.4538 18.1661 28.4561 18.1107 28.4561 18.062V17.9379ZM26.8605 18.0531C26.8605 18.0996 26.8605 18.1506 26.8583 18.2105C26.8561 18.3833 26.8516 18.5739 26.8472 18.78C26.8317 19.3695 26.8007 19.9589 26.7541 20.5063C26.6943 21.2199 26.6101 21.8049 26.5059 22.1972C26.3685 22.7091 25.9652 23.1146 25.4555 23.2498C24.9901 23.3739 23.8178 23.4736 22.2245 23.5334C21.4178 23.5645 20.5491 23.5844 19.6826 23.5955C19.379 23.5999 19.0976 23.6021 18.845 23.6021H18.2112L17.3735 23.5955C16.507 23.5844 15.6405 23.5645 14.8317 23.5334C13.2383 23.4714 12.0638 23.3739 11.6007 23.2498C11.091 23.1124 10.6876 22.7091 10.5502 22.1972C10.4461 21.8049 10.3619 21.2199 10.302 20.5063C10.2555 19.9589 10.2267 19.3695 10.209 18.78C10.2023 18.5739 10.2001 18.3811 10.1979 18.2105C10.1979 18.1506 10.1957 18.0974 10.1957 18.0531V17.9467C10.1957 17.9002 10.1957 17.8492 10.1979 17.7894C10.2001 17.6165 10.2045 17.426 10.209 17.2199C10.2245 16.6304 10.2555 16.0409 10.302 15.4936C10.3619 14.78 10.4461 14.1949 10.5502 13.8027C10.6876 13.2908 11.091 12.8852 11.6007 12.7501C12.066 12.626 13.2383 12.5262 14.8317 12.4664C15.6383 12.4354 16.507 12.4154 17.3735 12.4044C17.6771 12.3999 17.9585 12.3977 18.2112 12.3977H18.845L19.6826 12.4044C20.5491 12.4154 21.4156 12.4354 22.2245 12.4664C23.8178 12.5285 24.9923 12.626 25.4555 12.7501C25.9652 12.8875 26.3685 13.2908 26.5059 13.8027C26.6101 14.1949 26.6943 14.78 26.7541 15.4936C26.8007 16.0409 26.8295 16.6304 26.8472 17.2199C26.8538 17.426 26.8561 17.6188 26.8583 17.7894C26.8583 17.8492 26.8605 17.9024 26.8605 17.9467V18.0531ZM16.5558 20.9695L21.6971 17.9778L16.5558 15.0304V20.9695Z"
                                    fill="#D42328" />
                            </svg>
                        </a>
                    </div>
                </div>
                <div class="col-md-12 col-lg-8">
                    <div class="post-rating">
                        <span class="rating-text"><strong>Đánh giá:</strong> 5/5 (<?php echo get_comments_number(); ?> Bình
                            chọn)</span>

                        <div class="rating-stars">
                            <?php for ($i = 0; $i < 5; $i++): ?>
                                <svg width="19" height="18" viewBox="0 0 19 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M8.6449 2.15099C8.73202 2.00936 8.85681 1.89185 9.00684 1.81017C9.15686 1.7285 9.32687 1.68552 9.4999 1.68552C9.67293 1.68552 9.84293 1.7285 9.99296 1.81017C10.143 1.89185 10.2678 2.00936 10.3549 2.15099L12.5676 5.74949L16.8648 6.63149C17.0338 6.66629 17.1903 6.74245 17.3185 6.85239C17.4468 6.96233 17.5424 7.1022 17.5958 7.25806C17.6493 7.41392 17.6586 7.58032 17.623 7.74068C17.5874 7.90104 17.508 8.04975 17.3928 8.17199L14.4636 11.2777L14.907 15.4215C14.9245 15.5847 14.8965 15.7493 14.8258 15.899C14.7551 16.0487 14.6442 16.1783 14.5041 16.2747C14.3641 16.3711 14.1998 16.431 14.0276 16.4484C13.8555 16.4658 13.6815 16.4402 13.5231 16.374L9.4999 14.694L5.47665 16.374C5.31825 16.4402 5.1443 16.4658 4.97216 16.4484C4.80002 16.431 4.63573 16.3711 4.49567 16.2747C4.35562 16.1783 4.2447 16.0487 4.17401 15.899C4.10332 15.7493 4.07532 15.5847 4.09281 15.4215L4.53615 11.2777L1.60698 8.17274C1.49158 8.05051 1.41204 7.90174 1.3763 7.74128C1.34056 7.58082 1.34988 7.41429 1.40332 7.25831C1.45676 7.10233 1.55245 6.96236 1.68085 6.85237C1.80924 6.74238 1.96584 6.66622 2.13502 6.63149L6.43219 5.74949L8.6449 2.15099Z"
                                        fill="#FFD448" />
                                </svg>
                            <?php endfor; ?>
                        </div>
                    </div>
                </div>
            </div>
        </div>
<?php
    }
}
